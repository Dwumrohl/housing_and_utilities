@page "/user"

@using Microsoft.EntityFrameworkCore
@using testBlazor.Data;
@using testBlazor.Data.services
@using System.Text;

@inject IClientService ClientService
@inject IClientAddressService AddressService
@inject NavigationManager nav;

@attribute [Authorize]

<html>

<head>
    <title>Пользователь</title>
    <link rel="stylesheet" href="UserData.razor.css">
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700&amp;subset=cyrillic" rel="stylesheet">
</head>

<body>
    <div id="mainDiv">
        <div class="dataContainer">
            <h3>Личные данные</h3>
            <div class="innerDiv">
                <div class="inputDiv">
                    <p>Фамилия</p>
                    <input type="text" @bind="client.Surname" />
                </div>
                <div class="inputDiv">
                    <p>Имя</p>
                    <input type="text" @bind="client.Name" />
                </div>
                <div class="inputDiv">
                    <p>Отчество</p>
                    <input type="text" @bind="client.Patronymic" />
                </div>
            </div>
            <div class="innerDiv">
                <div class="inputDiv">
                    <p>Номер телефона</p>
                    <input type="text" @bind="client.PhoneNumber" />
                </div>
                <div class="inputDiv">
                    <p>Электронная почта</p>
                    <input type="text" @bind="client.Email" />
                </div>
                <div class="inputDiv">
                    <br />
                    <br />
                    <br />
                    <button class="saveButton" @onclick="updateUser">Сохранить</button>
                </div>
            </div>
        </div>
        <div class="dataContainer">
            <h3>Адрес</h3>
            <div class="innerDiv">
                <div class="inputDiv">
                    <p>Город</p>
                    <input type="text" @bind="address.City" />
                </div>
                <div class="inputDiv">
                    <p>Улица</p>
                    <input type="text" @bind="address.Street" />
                </div>
                <div class="inputDiv">
                    <p>Дом</p>
                    <input type="text" @bind="address.Building" />
                </div>
            </div>
            <div class="innerDiv">
                <div class="inputDiv">
                    <p>Подъезд</p>
                    <input type="text" @bind="address.House" />
                </div>
                <div class="inputDiv">
                    <p>Квартира</p>
                    <input type="text" @bind="address.Apartment" />
                </div>
                <div class="inputDiv">
                    <br />
                    <br />
                    <br />
                    <button class="saveButton" @onclick="addAddress">Добавить</button>
                </div>
            </div>
        </div>
        <div class="dataContainer" hidden="@hidden">
            <div class="addressList">
                <h3>Список адресов:</h3>
                <ul>
                    @if(!hidden) @foreach (var adrs in addresses)
                    {
                        <li>
                            <label>
                                @adrs.City
                                ,
                            </label>
                            <label>
                                @adrs.Street
                                ,
                            </label>
                            <label>
                                @adrs.Building
                                ,
                            </label>
                            <label>
                                @adrs.House
                                ,
                            </label>
                            <label>
                                @adrs.Apartment
                                ,
                            </label>
                        </li>
                    }
                </ul>
            </div>
        </div>
    </div>
</body>

</html>

@code {
    public string email { get; set; } = "";
    public bool hidden { get; set; } = true;
    Client? client = new Client();
    ClientAddress? address = new ClientAddress();
    List<ClientAddress> addresses = new List<ClientAddress>();

    public void updateUser()
    {
        ClientService.updateClientByEmail(email, client);
    }

    public void addAddress()
    {
        address.ClientId = client.ClientId;
        address.Client = client;
        AddressService.insertClientAddress(address);
        hidden = false;
        nav.NavigateTo(nav.Uri, forceLoad: true);
    }

}
